<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>n64brew: Exporting Models, Levels &amp; Animations for the Game</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">n64brew
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
   <div id="projectbrief">N64 Homebrew Game Engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Exporting Models, Levels &amp; Animations for the <a class="el" href="gametypes_8h.html#structGame">Game</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md2"></a>
Single-body Models</h1>
<p>For objects that have no moving parts ('single-body'), you can simply move them to the origin (though probably aligning the bottom to the origin is best, so they are 'sitting on the ground'), and then export as OBJ.</p>
<p>The model should be textured with a single UV-mapped 32x32 pixel BMP texture.</p>
<p>Single-body models should be exported with the following <b>settings</b> enabled:</p><ul>
<li>Write Normals</li>
<li>Include UVs</li>
</ul>
<p>plus any other ones which make sense for your scene/workflow (eg. Apply Modifiers, Selection Only, etc)</p>
<p>Run <code>./rebuild_models.sh</code> to turn your .obj file into a .h file containing displaylists for rendering the model.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md4"></a>
Level Editing</h1>
<p>Place all the objects you want in your game level blend file. They should have the same name as the ModelType defined to represent them in the ModelTypes enum.</p>
<p>Environment geometry can be exported directly from the level scene, using <code>export_map_meshes.py</code>. Select all mesh parts before running the script. If multiple parts are selected, the output .obj will contain them all. <code>./rebuild_models.sh</code> will produce a single .h file containing them all, with an array named <code>[objname]_model_meshes</code> to allow accessing mesh parts by index.</p>
<p>To export the level, run the script <code>export_positions.py</code> using Blender's text editor (or however you prefer to run Blender Python scripts). This script runs automatically when using <code>make</code>. This script expects a collection called <code>worldobjects</code> containing all the levels geometry. Objects named with the same modeltype but suffixed with a .xxx number (as added by copy-paste in Blender) will be exported with the 'subtype' field set to an incrementing number, which can be aligned with a multi part mesh to allow rendering of batch-exported environment geometry. Any further suffix after the string '.inst' will be stripped, allowing multiple instances of multi-part meshes to be created for geometry reuse. This means that you add a .inst suffix, then copy-paste, it will not create an additional subtype (eg. it will still use the same mesh part).</p>
<p>The script will create a <code>[levelname]_map.h</code> file at the location of the corresponding <code>[levelname].blend</code> file, containing the position, rotation &amp; modeltype of each visible(!) object in the scene. </p><blockquote class="doxtable">
<p>To export certain objects, set them to invisible in the Blender Editor before running the script. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md5"></a>
&lt;/blockquote&gt;</h1>
<h1><a class="anchor" id="autotoc_md6"></a>
Level Collision</h1>
<p>Similar to the export of the level map containing the level object layout the collision of a level can be exported using the <code>export_collision_mesh</code> script. This time a collection called <code>collision</code> is expected to contain the level collision geometry. Like before geometry can be excluded from the export by hiding the objects in the Blender editor first. The script will create multiple files, namely <code>[levelname]_map_collision.h</code>, <code>[levelname]_map_collision.c</code> &amp; <code>[levelname]_map_collision.json</code> file at the location of the corresponding <code>[levelname].blend</code> file, containing the collision triangle and spatial hash information as well as metadata. </p><blockquote class="doxtable">
<p>Note that the collision geometry in the <code>collision</code> collection must be triangulated. This can be achieved via the Blender Triangulate Modifier. </p>
</blockquote>
<p>-&mdash; </p>
<h1><a class="anchor" id="autotoc_md7"></a>
Character Animation</h1>
<p>Create a rigid body animation in Blender. There should be one Blender object per animatable body. Using an armature and parenting all the bodies to bones makes this easier, but is not essential.</p>
<p>There is a required naming scheme for the parts of the rigid body character. The parts must each be made up of an object containing a mesh which is named with the convention ${object_name}mesh, eg. an object called 'gooseneck' should have a mesh called 'gooseneckmesh' and when exported as .obj the resultant object section is called 'gooseneck_gooseneckmesh'.</p>
<p><a class="el" href="gametypes_8h.html#structCharacter">Character</a> models should be exported with the following settings enabled:</p><ul>
<li>Objects as OBJ objects</li>
<li>Write Normals</li>
<li>Include UVs</li>
</ul>
<p>as well as any other flags that make sense for your workflow.</p>
<p>To export the animation, run the script <code>export_animation.py</code> in Blender which will generate <code>${modelname}_anim.h</code></p>
<p>Manually create a <code>${modelname}animtypes.h</code> file defining a <code>${ModelName}MeshType</code> enum which includes all the enum values used to refer to model parts in <code>${modelname}_anim_data</code> of the generated <code>${modelname}_anim.h</code> file. Also define another enum which includes all the animation names in the order they are defined in <code>${modelname}_anim_ranges</code>. (maybe we can just output these enums into the generated header file in future?)</p>
<p>To export the character model, run the script <code>export_character_model.py</code> in Blender which will generate <code>${modelname}rig.obj</code>. Running <code>./rebuild_models.sh</code> will generate a .h file containing displaylists for rendering the model (one displaylist per model part).</p>
<p>Somewhere (<a class="el" href="stage00_8c.html" title="Stage 00, the Main stage that runs when the ROM starts.">stage00.c</a> ??) define an array like <code>Gfx* ${modelname}MeshList[] = {...}</code> containing pointers to the displaylists to render for each model part, in the same order as the corresponding parts appear in the <code>${ModelName}MeshType</code> enum. This mapping will be used to determine which displaylist to render for each <a class="el" href="animation_8h.html#structAnimationFrame">AnimationFrame</a> struct in the animation frame data. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
